# 实施计划：PDF 文本提取工具

## 概述

本实施计划将 PDF 文本提取工具分解为一系列增量开发任务。系统使用 Python 实现，采用 pdfplumber 库进行 PDF 处理，jieba 进行中文分词，Hypothesis 进行基于属性的测试。实施过程遵循从核心功能到高级特性的渐进式开发策略。

## 任务

- [x] 1. 搭建项目结构和核心接口
  - 创建项目目录结构（src/, tests/, docs/）
  - 设置 Python 虚拟环境和依赖管理（requirements.txt 或 pyproject.toml）
  - 安装核心依赖：pdfplumber, jieba, hypothesis, pytest
  - 定义核心数据模型类（PDFDocument, PageText, ExtractedContent, KeyInformation）
  - 定义自定义异常类（PDFExtractionError 及其子类）
  - _需求：1.1, 2.1, 7.1_

- [ ] 2. 实现路径处理器
  - [x] 2.1 实现 PathHandler 类
    - 实现 normalize_path 方法（处理 Windows 路径、相对路径、中文字符、空格）
    - 实现 validate_path 方法（验证路径有效性）
    - 实现 is_pdf_file 方法（检查文件扩展名）
    - _需求：4.1, 4.2, 4.3, 4.4, 4.5_
  
  - [ ]* 2.2 编写路径处理器的属性测试
    - **属性 7：路径规范化一致性**
    - **验证需求：4.1, 4.2, 4.3, 4.4**
  
  - [ ]* 2.3 编写路径验证的属性测试
    - **属性 8：无效路径被拒绝**
    - **验证需求：4.5**

- [ ] 3. 实现 PDF 读取器
  - [x] 3.1 实现 PDFReader 类
    - 实现 open 方法（使用 pdfplumber 打开 PDF）
    - 实现 get_page_count 方法
    - 实现 close 方法
    - 处理文件不存在、格式错误、权限错误等异常
    - _需求：1.1, 1.2, 1.3, 1.4, 1.5_
  
  - [ ]* 3.2 编写 PDF 读取器的属性测试
    - **属性 1：有效 PDF 文件可读性**
    - **验证需求：1.1, 1.4**
  
  - [ ]* 3.3 编写错误处理的属性测试
    - **属性 2：错误条件正确分类**
    - **验证需求：1.2, 1.3, 6.2**
  
  - [ ]* 3.4 编写单元测试
    - 测试只读模式打开被占用的文件
    - 测试各种错误情况的具体示例
    - _需求：1.5_

- [x] 4. 检查点 - 确保基础功能正常
  - 确保所有测试通过，如有问题请询问用户

- [ ] 5. 实现文本提取器
  - [x] 5.1 实现 TextExtractor 类
    - 实现 extract_text 方法（从单个页面提取文本）
    - 实现 extract_all_text 方法（提取所有页面，带错误恢复）
    - 确保 UTF-8 编码处理正确
    - 处理空页面和提取失败的情况
    - _需求：2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5_
  
  - [ ]* 5.2 编写文本提取完整性的属性测试
    - **属性 3：文本提取完整性**
    - **验证需求：2.1, 2.3**
  
  - [ ]* 5.3 编写文本顺序保持的属性测试
    - **属性 4：文本顺序保持不变**
    - **验证需求：2.2**
  
  - [ ]* 5.4 编写部分失败恢复的属性测试
    - **属性 5：部分失败不影响成功部分**
    - **验证需求：2.5, 6.5**
  
  - [ ]* 5.5 编写中文内容提取的属性测试
    - **属性 6：中文内容正确提取**
    - **验证需求：3.1, 3.2, 3.3, 3.4, 3.5**
  
  - [ ]* 5.6 编写单元测试
    - 测试空页面处理
    - 测试特定的中文编码场景
    - _需求：2.4_

- [ ] 6. 实现关键信息分析器
  - [x] 6.1 实现 KeyInfoAnalyzer 类
    - 实现 extract_headings 方法（识别标题和章节）
    - 实现 extract_keywords 方法（使用 jieba 分词和词频统计）
    - 实现 generate_summary 方法（提取前几句作为摘要）
    - 实现 extract_lists 方法（识别列表结构）
    - _需求：5.1, 5.2, 5.3, 5.4_
  
  - [ ]* 6.2 编写标题识别的属性测试
    - **属性 9：标题识别准确性**
    - **验证需求：5.1**
  
  - [ ]* 6.3 编写关键词提取的属性测试
    - **属性 10：关键词提取相关性**
    - **验证需求：5.2**
  
  - [ ]* 6.4 编写摘要生成的属性测试
    - **属性 11：摘要长度约束**
    - **验证需求：5.3**
  
  - [ ]* 6.5 编写列表结构保持的属性测试
    - **属性 12：列表结构保持**
    - **验证需求：5.4**

- [ ] 7. 实现输出格式化器
  - [x] 7.1 实现 OutputFormatter 类
    - 实现 format_as_text 方法（纯文本格式）
    - 实现 format_as_json 方法（JSON 格式，包含页码信息）
    - 实现 format_as_markdown 方法（Markdown 格式）
    - 实现 save_to_file 方法（保存到文件，UTF-8 编码）
    - _需求：7.1, 7.2, 7.3, 7.4, 7.5, 8.1, 8.2, 8.4_
  
  - [ ]* 7.2 编写纯文本输出的属性测试
    - **属性 15：纯文本输出格式**
    - **验证需求：7.1**
  
  - [ ]* 7.3 编写 JSON 序列化的属性测试
    - **属性 16：JSON 序列化往返一致性**
    - **验证需求：7.2, 7.3**
  
  - [ ]* 7.4 编写 UTF-8 编码的属性测试
    - **属性 17：UTF-8 编码一致性**
    - **验证需求：7.4**
  
  - [ ]* 7.5 编写文件保存的属性测试
    - **属性 18：文件保存往返一致性**
    - **验证需求：8.1, 8.2, 8.4**
  
  - [ ]* 7.6 编写文件保存反馈的属性测试
    - **属性 19：文件保存成功反馈**
    - **验证需求：8.5**
  
  - [ ]* 7.7 编写单元测试
    - 测试文件覆盖场景
    - 测试不同输出格式的具体示例
    - _需求：8.3_

- [x] 8. 检查点 - 确保核心组件完整
  - 确保所有测试通过，如有问题请询问用户

- [ ] 9. 实现应用服务层
  - [x] 9.1 实现 PDFExtractionService 类
    - 初始化所有组件（reader, extractor, analyzer, formatter, path_handler）
    - 实现 extract 方法（协调完整的提取流程）
    - 实现错误处理和日志记录
    - 实现进度指示功能（对于大文件）
    - _需求：所有需求的集成_
  
  - [ ]* 9.2 编写错误消息中文化的属性测试
    - **属性 13：错误消息中文化**
    - **验证需求：6.1**
  
  - [ ]* 9.3 编写错误日志记录的属性测试
    - **属性 14：错误日志记录**
    - **验证需求：6.4**
  
  - [ ]* 9.4 编写集成测试
    - 测试完整的端到端流程
    - 测试各种配置选项组合
    - _需求：所有需求_

- [ ] 10. 实现命令行接口
  - [x] 10.1 创建 CLI 模块
    - 使用 argparse 实现命令行参数解析
    - 支持参数：输入文件路径、输出文件路径、输出格式、是否提取关键信息
    - 实现用户友好的帮助信息（中文）
    - 实现进度显示和结果输出
    - _需求：所有需求的用户接口_
  
  - [ ]* 10.2 编写 CLI 单元测试
    - 测试参数解析
    - 测试各种命令行选项组合
    - _需求：5.5, 7.5_

- [ ] 11. 添加配置和日志系统
  - [x] 11.1 实现配置管理
    - 创建配置文件支持（可选）
    - 支持配置关键信息提取的详细程度
    - _需求：5.5_
  
  - [x] 11.2 实现日志系统
    - 配置 Python logging 模块
    - 实现中文错误消息模板
    - 确保所有错误都被记录
    - _需求：6.1, 6.4_

- [ ] 12. 创建示例和文档
  - [x] 12.1 创建使用示例
    - 准备示例 PDF 文件（包含中文内容）
    - 编写示例脚本展示各种用法
    - _需求：所有需求的演示_
  
  - [ ] 12.2 编写 README 文档
    - 项目介绍和功能说明（中文）
    - 安装说明
    - 使用示例
    - API 文档
    - _需求：所有需求的文档_

- [ ] 13. 最终检查点 - 完整性验证
  - 运行所有测试（单元测试和属性测试）
  - 验证所有 19 个属性都有对应的测试
  - 检查代码覆盖率（目标 > 80%）
  - 测试实际的 PDF 文件提取
  - 确认中文内容处理正确
  - 如有问题请询问用户

## 注意事项

- 标记 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求以确保可追溯性
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边缘情况
- 所有文本处理使用 UTF-8 编码以确保中文支持
